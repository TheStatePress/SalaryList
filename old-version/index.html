<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="Arizona State University employee salaries from 2012-2017 in a searchable table">
    <meta name="keywords" content="ASU,Salary,Salaries,employees,wage,wages,arizona, state, university, higher ed, education, school, faculty, staff, professor, teacher, table, search">
    <title>ASU Employee Salaries</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
        crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /*
 * Globals
 */
        /*
 * Base structure
 */

        .btn-secondary,
        .btn-secondary:hover,
        .btn-secondary:focus {
            color: #fff;
            text-shadow: none;
            /* Prevent inheritance from `body` */
            background-color: #8c383e;
            border: .05rem solid #fff;
        }

        .btn-secondary:disabled {
            background-color: #C59B9E;
        }

        html,
        body {
            height: 100%;
        }

        body {
            text-align: center;
        }
        /* Extra markup and styles for table-esque vertical and horizontal centering */

        .site-wrapper {
            display: table;
            width: 100%;
            height: 100%;
            /* For at least Firefox */
            min-height: 100%;
        }

        .site-wrapper-inner {
            display: table-cell;
            vertical-align: top;
        }

        .cover-container {
            margin-right: auto;
            margin-left: auto;
        }
        /* Padding for spacing */

        .inner {
            padding: 2rem;
        }
        /*
 * Header
 */

        .masthead {
            margin-bottom: 2rem;
        }

        .masthead-brand {
            margin-bottom: 0;
        }
        /*
 * Cover
 */

        .cover {
            padding: 0 1.5rem;
        }

        .cover .btn-lg {
            padding: .75rem 1.25rem;
            font-weight: bold;
        }
        /*
 * Footer
 */

        .mastfoot {
            color: black;
        }
        /*
 * Affix and center
 */

        @media (min-width: 40em) {
            /* Pull out the header and footer */
            /*.masthead {
                position: fixed;
                top: 0;
            }

            .mastfoot {
                position: fixed;
                bottom: 0;
            }*/
            /* Start the vertical centering */
            .site-wrapper-inner {
                vertical-align: middle;
            }
            /* Handle the widths */
            .masthead,
            .mastfoot,
            .cover-container {
                width: 100%;
                /* Must be percentage or pixels for horizontal alignment */
            }
        }

        @media (min-width: 62em) {
            .masthead,
            .mastfoot,
            .cover-container {
                width: 42rem;
            }
        }
    </style>
    <style>
        .schoolGroup,
        .yearGroup {
            margin: 5px;
        }
        /* Chrome, Safari, Opera */

        @-webkit-keyframes mymove {
            50% {
                vertical-align: 300px;
            }
        }
        /* Standard syntax */

        @keyframes mymove {
            50% {
                vertical-align: 300px;
            }
        }

        .dataTable {
            overflow-x: hidden;
        }

        #userInputs {
            -webkit-transition: all 1s ease;
            -moz-transition: all 1s ease;
            -o-transition: all 1s ease;
            transition: all 1s ease;
        }

        #nameDown,
        #nameUp,
        #positionDown,
        #positionUp,
        #salaryUp {
            color: black;
        }

        #salaryDown {
            color: gold;
        }

        .pagination {
            display: none;
            margin: 10px 0;
        }

        th,
        td {
            width: 33%;
        }

        tr:hover {
            background-color: lightgray;
        }

        #page-description {
            padding: 30px 0;
        }
    </style>
</head>

<body>
    <div class="site-wrapper">

        <div class="site-wrapper-inner">

            <div class="cover-container">

                <div class="masthead clearfix">
                    <div class="inner">
                        <h1 class="masthead-brand">Salaries of Arizona State University Employees</h1>
                        <hr>
                        <p class="lead" id="page-description">Salaries from Arizona State University employees are searchable through this database, curated by
                            The State Press. The included data was provided by the University and is public record under
                            A.R.S. 13-121 et seq.
                            <hr>
                        </p>
                    </div>
                </div>


                <div class="inner cover">
                    <h1 class="cover-heading">Search</h1>
                    <div class="input-group input-group-lg">
                        <span class="input-group-addon" id="sizing-addon1">Search Term</span>
                        <input type="text" class="form-control search" placeholder="Name/Description" aria-describedby="sizing-addon1" id="searchBar">
                    </div>
                    <div class="btn-group btn-group-lg yearGroup" role="group" aria-label="Year">
                        <button type="button" class="btn btn-secondary year" disabled>2017</button>
                        <button type="button" class="btn btn-secondary year">2016</button>
                        <button type="button" class="btn btn-secondary year">2015</button>
                        <button type="button" class="btn btn-secondary year">2014</button>
                        <button type="button" class="btn btn-secondary year">2013</button>
                        <button type="button" class="btn btn-secondary year">2012</button>
                    </div>
                    <br>
                </div>
                <div id="loading">
                    <p>Loading...</p>
                </div>
                <div class="btn-group btn-group-sm pagination" role="group">
                    <button type="button" class="btn btn-secondary firstPage">&laquo;</button>
                    <button type="button" class="btn btn-secondary prevPage">&lsaquo;</button>
                    <button type="button" class="btn btn-secondary nextPage">&rsaquo;</button>
                    <button type="button" class="btn btn-secondary lastPage">&raquo;</button>
                </div>
                <div class="dataTable">
                    <table class="table">
                        <thead class="thead-default">
                            <tr>
                                <th id="name">Name
                                    <i id="nameDown" class="material-icons">arrow_drop_down</i>
                                    <i id="nameUp" class="material-icons">arrow_drop_up</i>
                                </th>
                                <th id="position">Position
                                    <i id="positionDown" class="material-icons">arrow_drop_down</i>
                                    <i id="positionUp" class="material-icons">arrow_drop_up</i>
                                </th>
                                <th id="salary">Salary
                                    <i id="salaryDown" class="material-icons">arrow_drop_down</i>
                                    <i id="salaryUp" class="material-icons">arrow_drop_up</i>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="data">
                        </tbody>
                    </table>
                </div>
                <div class="btn-group btn-group-sm pagination" role="group">
                    <button type="button" class="btn btn-secondary firstPage">&laquo;</button>
                    <button type="button" class="btn btn-secondary prevPage">&lsaquo;</button>
                    <button type="button" class="btn btn-secondary nextPage">&rsaquo;</button>
                    <button type="button" class="btn btn-secondary lastPage">&raquo;</button>
                </div>
                <div class="mastfoot">
                    <div class="inner">
                        <p>Created for
                            <a target="_blank" href="http://www.statepress.com/">The State Press</a> by
                            <a target="_blank" href="https://github.com/James-Quigley">James Quigley</a>. Original data acquired by Reilly Kneedler.</p>
                    </div>
                </div>

            </div>

        </div>

    </div>


    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
        crossorigin="anonymous"></script>
    <script>
        var years = ["2012", "2013", "2014", "2015", "2016", "2017"];
        var data = [];

        function cleanData(data) {
            salaryDat = data.values;
            salaryDat.splice(0, 1); //remove the first result, which specifies the header row.
            salaryDat = salaryDat.map(function (employee) {
                /** Employee object, also has property domRef which is assigned at render time */
                return {
                    name: employee[1].split(",")[1] + " " + employee[1].split(",")[0],
                    job: employee[2],
                    dept: employee[3],
                    current: employee[4]
                }
            });
            return salaryDat;
        }

        function loadData() {
            for (var i = 0; i < years.length; i++) {
                var newUrl = "ASU-" + years[i] + ".json";
                makeReq(i, newUrl, data);
            }
            return data;
        }

        function makeReq(i, url, data) {
            $.getJSON(url, function (json) {
                data[i] = cleanData(json);
                if (data.length == years.length) {
                    renderList(data[years.length - 1]);
                }
            })
        }
    </script>
    <script>
        var typingTimer; //timer identifier
        var doneTypingInterval = 250; //time in ms (5 seconds)
        var sortingName = false;
        var sortingPosition = false;
        var sortingSalary = true;
        var sortType = 0;
        var maxTableLength = 50;
        var pageShowing = 0;
        var rows = [];

        //on keyup, start the countdown
        $('#searchBar').keyup(function () {
            clearTimeout(typingTimer);
            typingTimer = setTimeout(doneTyping, doneTypingInterval);
        });

        $('#searchBar').keydown(function (event) {
            if (event.which != 8) {
                var value = this.value;
                var index = performHash(value);
                if (!searchCache[index] || searchCache[index].searchValue != value) {
                    for (var i = value.length - 2; i >= 0; i--) {
                        var subIndex = performHash(value.substring(0, i + 1));
                        if (searchCache[subIndex] && searchCache[subIndex].searchValue == value.substring(0, i +
                                1)) {
                            var search = doFilter(searchCache[subIndex].results, value);
                            addToCache(search);
                            return;
                        }
                    }
                    var search = doFilter(data[year], value);
                    addToCache(search);
                    return;
                }
            }
        });

        //user is "finished typing," do something
        function doneTyping() {
            searchSalaries($("#searchBar")[0]);
        }

        $(".search").on('input', function () {
            if ($(this).val() == "") {
                $("#userInputs").removeClass("test");
            } else {
                $("#userInputs").addClass("test");
            }
        });

        $("th").click(function () {
            var arrows = [
                $("#nameUp"),
                $("#nameDown"),
                $("#positionUp"),
                $("#positionDown"),
                $("#salaryUp"),
                $("#salaryDown")
            ];
            switch (this.id) {
                case "name":
                    if (sortingName) {
                        if (sortType) {
                            $("#nameUp").css("color", "white");
                            $("#nameDown").css("color", "gold");
                        } else {
                            $("#nameDown").css("color", "white");
                            $("#nameUp").css("color", "gold");
                        }
                        sortType = !sortType;
                        break;
                    } else {
                        sortingPosition = false;
                        sortingSalary = false;
                        sortingName = true;
                        sortType = 0;
                        $("i").each(function () {
                            $(this).css("color", "white");
                        });
                        $("#nameDown").css("color", "gold");
                    }
                    break;
                case "position":
                    if (sortingPosition) {
                        if (sortType) {
                            $("#positionUp").css("color", "white");
                            $("#positionDown").css("color", "gold");
                        } else {
                            $("#positionDown").css("color", "white");
                            $("#positionUp").css("color", "gold");
                        }
                        sortType = !sortType;
                        break;
                    } else {
                        sortingPosition = true;
                        sortingSalary = false;
                        sortingName = false;
                        sortType = 0;
                        $("i").each(function () {
                            $(this).css("color", "white");
                        });
                        $("#positionDown").css("color", "gold");
                    }
                    break;
                case "salary":
                    if (sortingSalary) {
                        if (sortType) {
                            $("#salaryUp").css("color", "white");
                            $("#salaryDown").css("color", "gold");
                        } else {
                            $("#salaryDown").css("color", "white");
                            $("#salaryUp").css("color", "gold");
                        }
                        sortType = !sortType;
                        break;
                    } else {
                        sortingPosition = false;
                        sortingSalary = true;
                        sortingName = false;
                        sortType = 0;
                        $("i").each(function () {
                            $(this).css("color", "white");
                        });
                        $("#salaryDown").css("color", "gold");
                    }
                    break;
            }
            searchSalaries($("#searchBar")[0]);
        });

        $(".firstPage").click(function () {
            if (pageShowing != 0) {
                pageShowing = 0;
                drawTable(rows.slice(0, maxTableLength));
            }
        });

        $(".prevPage").click(function () {
            if (pageShowing != 0) {
                pageShowing--;
                var pageIndex = pageShowing * maxTableLength;
                drawTable(rows.slice(pageIndex, pageIndex + maxTableLength));
            }
        });

        $(".nextPage").click(function () {
            if (pageShowing != Math.floor(rows.length / maxTableLength)) {
                pageShowing++;
                if (pageShowing == Math.floor(rows.length / maxTableLength)) {
                    drawTable(rows.slice(pageShowing * maxTableLength));
                } else {
                    drawTable(rows.slice(pageShowing * maxTableLength, pageShowing * maxTableLength +
                        maxTableLength));
                }
            }
        });

        $(".lastPage").click(function () {
            if (pageShowing != Math.floor(rows.length / maxTableLength)) {
                pageShowing = Math.floor(rows.length / maxTableLength);
                drawTable(rows.slice(pageShowing * maxTableLength));
            }
        });
    </script>
    <script>
        var dataDom = document.getElementById("data");
        var salaries = [];

        function sortData(data) {
            if (sortingName) {
                return data.sort(compareName);
            } else if (sortingPosition) {
                return data.sort(comparePosition);
            } else {
                return data.sort(compareSalary);
            }
        }

        function compareName(a, b) {
            if (a.name < b.name) {
                return 1;
            }
            if (a.name > b.name) {
                return -1;
            }
            return 0;
        }

        function comparePosition(a, b) {
            if (a.job < b.job) {
                return 1;
            }
            if (a.job > b.job) {
                return -1;
            }
            return 0;
        }

        function compareSalary(a, b) {
            var c = JSON.parse(JSON.stringify(a));
            var d = JSON.parse(JSON.stringify(b));
            c.current = parseInt(c.current.substring(1, c.current.length).split(",").join(""));
            d.current = parseInt(d.current.substring(1, d.current.length).split(",").join(""));
            if (c.current < d.current) {
                return -1;
            }
            if (c.current > d.current) {
                return 1;
            }
            return 0;
        }

        //takes an array of salaries
        function renderList(salaryDat) {
            pageShowing = 0;
            rows = [];
            salaryDat = sortData(salaryDat);
            if (sortType) {
                for (var i = 0; i < salaryDat.length; i++) {
                    var employee = salaryDat[i];
                    var row = "<tr><td>" + employee.name + "</td><td>" + employee.job + "</td><td>" + employee.current +
                        "</td></tr>";
                    rows.push(row);
                }
            } else {
                for (var i = salaryDat.length - 1; i >= 0; i--) {
                    var employee = salaryDat[i];
                    var row = "<tr><td>" + employee.name + "</td><td>" + employee.job + "</td><td>" + employee.current +
                        "</td></tr>";
                    rows.push(row);
                }
            }
            $("#data").empty();
            if (rows.length > maxTableLength) {
                $(".pagination").show();
                drawTable(rows.slice(0, maxTableLength));
                $("#loading").hide();
            } else {
                $(".pagination").hide();
                drawTable(rows);
                $("#loading").hide();

            }


            salaries = salaryDat;
        }

        function drawTable(data) {
            $("#data").empty();
            dataDom.innerHTML = data.join(" ");
        }


        var searchCache = [];
        var cacheIndex = 0;
        var CACHEMAXSIZE = 500;

        function performHash(string) {
            string = string.toUpperCase();
            var a = 1;
            var b = 1;
            for (var i = 0; i < string.length; i++) {
                var n = string.charCodeAt(i);
                var stringn = ('' + n);
                var c = 0;
                a *= stringn[0];
                a *= stringn[1];
                c += (stringn[0] - 0);
                c += (stringn[1] - 0);
                b *= c;
            }
            return ((a + b) % CACHEMAXSIZE);
        }

        function addToCache(results) {
            var index = performHash(results.searchValue);
            if (!searchCache[index] || searchCache[index].searchValue != results.searchValue) {
                searchCache[index] = results;
            }
        }

        function queueSearch(searchComponent) {
            searchSalaries(searchComponent);
        }

        function searchSalaries(searchComponent) {
            var value = searchComponent.value.toLowerCase();
            /*Empty string. render the whole list*/
            if (value == "") {
                renderList(data[year]);
                return;
            }
            /*If there are items in our cache...*/
            if (searchCache.length > 0) {
                var index = performHash(value);
                /*If nothing is in the hashtable OR something exists, but it doesn't match*/
                if (!searchCache[index] || searchCache[index].searchValue != value) {
                    /*Iterate over substring to see if we find a hit for any of those in the cache*/
                    for (var i = value.length - 2; i >= 0; i--) {
                        var subIndex = performHash(value.substring(0, i + 1));
                        /*If it exists AND the value matches*/
                        if (searchCache[subIndex] && searchCache[subIndex].searchValue == value.substring(0, i + 1)) {
                            var search = doFilter(searchCache[subIndex].results, value);
                            addToCache(search);
                            renderList(search.results);
                            return;
                        }
                    }
                    var search = doFilter(data[year], value);
                    addToCache(search);
                    renderList(search.results);
                    return;
                }
                /*We found the value in the cache*/
                else {
                    renderList(searchCache[index].results);
                    return;
                }
            }
            /*Nothing in the cache. Do a search on all of the data*/
            else {
                //initial search
                var search = doFilter(data[year], value);
                addToCache(search);
                renderList(search.results);
                return;
            }
        }

        function doFilter(searchSpace, searchValue) {
            var searchResult = {
                results: searchSpace.filter(function (employee) {
                    if (employee.name.toLowerCase().includes(searchValue) || employee.job.toLowerCase().includes(
                            searchValue)) {
                        return true;
                    } else {
                        return false;
                    }
                }),
                searchValue: searchValue
            }
            return searchResult;
        }
    </script>
    <script>
        var year = years.length - 1;
        $(".year").click(function () {
            year = parseInt(this.innerHTML) - 2012;
            $(".year").each(function () {
                $(this).prop('disabled', false);
            });
            $(this).prop('disabled', true);
            searchCache = [];
            searchSalaries($("#searchBar")[0]);
        });
        loadData();
    </script>
</body>

</html>
